services:
  test:
    build:
      context: ..
      dockerfile_inline: |
        FROM alpine:latest

        # Install dependencies
        RUN apk add --no-cache bash zsh bats bats-support bats-assert fd util-linux

        COPY test/mocks/* /usr/local/bin/

        WORKDIR /app
    volumes:
      - ..:/app:ro
    environment:
      BATS_LIB_PATH: /usr/lib/bats:/app/test
      PATH: /app/bin/linux-amd64/commands:/home/linuxbrew/.linuxbrew/bin:/usr/local/bin:/usr/bin:/bin
      CLAUDECODE: "1"
    entrypoint: ["bats"]
